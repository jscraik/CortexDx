# Consolidated Report Workflow (ReportManager)

CortexDx can store every diagnose/orchestrate run as a structured artifact in addition to the ad-hoc Markdown/JSON files. Passing `--report-out <dir>` writes:

- `report.json`, `report.md`, `report.html`: consolidated findings with metadata.
- `index.db`: a SQLite catalog of all stored reports (session id, timestamp, severity).
- Per-run subdirectories organized by date/session depending on configuration.

## Running Locally

```bash
# Diagnose and persist reports
cortexdx diagnose https://mcp.example.com \
  --out reports \
  --report-out .cortexdx/reports

# Orchestrate LangGraph workflow with consolidated artifact
cortexdx orchestrate https://mcp.example.com \
  --workflow agent.langgraph.baseline \
  --report-out .cortexdx/reports
```

The CLI mirrors the behavior in CI (see `.github/workflows/cortexdx.yml`), so reviewers always get the same artifact layout whether the run happens locally or in GitHub Actions.

## Sharing Reports via Signed URLs

Configure these environment variables before invoking `--report-out` to hand stakeholders a downloadable bundle without granting repo access:

- `CORTEXDX_REPORT_DIR`: absolute path where ReportManager writes artifacts (defaults to `./reports`). Point this at a workspace mounted to your object store sync job.
- `CORTEXDX_REPORT_URL`: the base HTTPS URL (pre-signed S3 bucket, Cloudflare R2 custom domain, etc.) that maps to the directory above. Each stored report receives a stable `<baseUrl>/<reportId>` link that you can paste into the clientâ€™s MCP console or ticket.
- `CORTEXDX_REPORT_STRATEGY`: optionally switch between `date`, `session`, or `type` subdirectories when mirroring to cloud storage.

The shareable URL conventions implement the remediation guidance gathered from the latest academic sweep (`packages/cortexdx/packages/cortexdx/reports/research-mcp-comms/.../2025-11-14T20-27-37-459Z/`) so Cortex Vibe (and other MCP tenants) can download the Markdown + JSON findings bundle directly from a url-safe location.

## Review Checklist

1. Download the `reports/` artifact generated by CI (look for the `report-out` directory).
2. Inspect the latest Markdown/JSON file (e.g., `orchestrate-workflow/<timestamp>/report.md`) to confirm findings/evidence.
3. Query `index.db` (e.g., using `sqlite3 index.db "SELECT id, diagnostic_type, created_at FROM reports ORDER BY created_at DESC;"`) to verify history and ensure multiple suites recorded their output.
4. Confirm `metadata` contains the suite/workflow identifiers plus any research summary (when `--research*` was used). If those fields are missing, request a re-run with the correct CLI flags.

Use this document as the reference whenever you need to add new report surfaces or explain the artifact hierarchy to reviewers.
