<?xml version="1.0" encoding="UTF-8"?>
<idea-plugin>
    <id>io.brainwav.cortexdx</id>
    <name>CortexDx</name>
    <vendor email="support@brainwav.io" url="https://brainwav.io">brAInwav</vendor>

    <description><![CDATA[
        Real-time MCP (Model Context Protocol) validation and assistance for IntelliJ-based IDEs.
        
        Features:
        - Real-time diagnostics and validation
        - Context-aware code completions
        - Quick fixes and automated refactoring
        - Project-wide analysis
        - Test generation
        - Interactive debugging assistance
    ]]></description>

    <change-notes><![CDATA[
        <h3>1.0.0</h3>
        <ul>
            <li>Initial release</li>
            <li>Real-time MCP validation</li>
            <li>Code completions and suggestions</li>
            <li>Quick fixes for common issues</li>
            <li>Project analysis tools</li>
        </ul>
    ]]></change-notes>

    <!-- Product and plugin compatibility requirements -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- External Annotator for real-time diagnostics -->
        <externalAnnotator
                language="TypeScript"
                implementationClass="io.brainwav.cortexdx.CortexDxExternalAnnotator"/>
        <externalAnnotator
                language="JavaScript"
                implementationClass="io.brainwav.cortexdx.CortexDxExternalAnnotator"/>
        <externalAnnotator
                language="Python"
                implementationClass="io.brainwav.cortexdx.CortexDxExternalAnnotator"/>

        <!-- Completion Contributor -->
        <completion.contributor
                language="TypeScript"
                implementationClass="io.brainwav.cortexdx.CortexDxCompletionContributor"/>
        <completion.contributor
                language="JavaScript"
                implementationClass="io.brainwav.cortexdx.CortexDxCompletionContributor"/>

        <!-- Intention Actions (Quick Fixes) -->
        <intentionAction>
            <className>io.brainwav.cortexdx.intentions.AddInputSchemaIntention</className>
            <category>CortexDx</category>
        </intentionAction>
        <intentionAction>
            <className>io.brainwav.cortexdx.intentions.FixJsonRpcVersionIntention</className>
            <category>CortexDx</category>
        </intentionAction>
        <intentionAction>
            <className>io.brainwav.cortexdx.intentions.AddErrorHandlingIntention</className>
            <category>CortexDx</category>
        </intentionAction>

        <!-- Code Formatter -->
        <formattingService
                implementation="io.brainwav.cortexdx.CortexDxFormattingService"/>

        <!-- Project Service -->
        <projectService
                serviceImplementation="io.brainwav.cortexdx.CortexDxProjectService"/>

        <!-- Application Service -->
        <applicationService
                serviceImplementation="io.brainwav.cortexdx.CortexDxApplicationService"/>

        <!-- Settings -->
        <projectConfigurable
                instance="io.brainwav.cortexdx.settings.CortexDxSettingsConfigurable"
                displayName="CortexDx"
                id="cortexdx.mcp.settings"/>

        <!-- Tool Window -->
        <toolWindow
                id="CortexDx"
                anchor="bottom"
                icon="/icons/cortexdx.svg"
                factoryClass="io.brainwav.cortexdx.toolwindow.CortexDxToolWindowFactory"/>
    </extensions>

    <actions>
        <!-- Main Menu Actions -->
        <group id="CortexDxMenu" text="CortexDx" popup="true">
            <add-to-group group-id="ToolsMenu" anchor="last"/>

            <action
                    id="CortexDx.ValidateFile"
                    class="io.brainwav.cortexdx.actions.ValidateFileAction"
                    text="Validate Current File"
                    description="Validate MCP code in current file">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift V"/>
            </action>

            <action
                    id="CortexDx.AnalyzeProject"
                    class="io.brainwav.cortexdx.actions.AnalyzeProjectAction"
                    text="Analyze Project"
                    description="Analyze entire project for MCP issues"/>

            <action
                    id="CortexDx.GenerateTests"
                    class="io.brainwav.cortexdx.actions.GenerateTestsAction"
                    text="Generate Tests"
                    description="Generate test cases for MCP code"/>

            <action
                    id="CortexDx.FormatCode"
                    class="io.brainwav.cortexdx.actions.FormatCodeAction"
                    text="Format MCP Code"
                    description="Format code according to MCP best practices">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift F"/>
            </action>

            <separator/>

            <action
                    id="CortexDx.StartServer"
                    class="io.brainwav.cortexdx.actions.StartServerAction"
                    text="Start MCP Server"
                    description="Start CortexDx server"/>

            <action
                    id="CortexDx.StopServer"
                    class="io.brainwav.cortexdx.actions.StopServerAction"
                    text="Stop MCP Server"
                    description="Stop CortexDx server"/>
        </group>

        <!-- Editor Context Menu -->
        <group id="CortexDxEditorPopup">
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <separator/>
            <reference ref="CortexDx.ValidateFile"/>
            <reference ref="CortexDx.GenerateTests"/>
            <reference ref="CortexDx.FormatCode"/>
        </group>
    </actions>

    <applicationListeners>
        <listener
                class="io.brainwav.cortexdx.listeners.CortexDxProjectListener"
                topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </applicationListeners>
</idea-plugin>
