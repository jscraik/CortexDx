{
    "dashboard": {
        "title": "CortexDx - Overview",
        "tags": [
            "cortexdx",
            "mcp",
            "diagnostics"
        ],
        "timezone": "browser",
        "schemaVersion": 38,
        "version": 1,
        "refresh": "30s",
        "panels": [
            {
                "id": 1,
                "title": "Service Health",
                "type": "stat",
                "gridPos": {
                    "h": 4,
                    "w": 6,
                    "x": 0,
                    "y": 0
                },
                "targets": [
                    {
                        "expr": "up{job=\"cortexdx\"}",
                        "legendFormat": "{{instance}}"
                    }
                ],
                "options": {
                    "colorMode": "background",
                    "graphMode": "none",
                    "textMode": "value_and_name"
                },
                "fieldConfig": {
                    "defaults": {
                        "mappings": [
                            {
                                "type": "value",
                                "value": "0",
                                "text": "Down",
                                "color": "red"
                            },
                            {
                                "type": "value",
                                "value": "1",
                                "text": "Up",
                                "color": "green"
                            }
                        ],
                        "thresholds": {
                            "mode": "absolute",
                            "steps": [
                                {
                                    "value": 0,
                                    "color": "red"
                                },
                                {
                                    "value": 1,
                                    "color": "green"
                                }
                            ]
                        }
                    }
                }
            },
            {
                "id": 2,
                "title": "Request Rate",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 0,
                    "y": 4
                },
                "targets": [
                    {
                        "expr": "rate(cortexdx_mcp_requests_total[5m])",
                        "legendFormat": "{{method}} {{endpoint}}"
                    }
                ],
                "yaxes": [
                    {
                        "format": "reqps",
                        "label": "Requests/sec"
                    },
                    {
                        "format": "short"
                    }
                ]
            },
            {
                "id": 3,
                "title": "Error Rate",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 12,
                    "y": 4
                },
                "targets": [
                    {
                        "expr": "rate(cortexdx_mcp_requests_total{status=~\"5..\"}[5m])",
                        "legendFormat": "{{status}} errors"
                    }
                ],
                "yaxes": [
                    {
                        "format": "reqps",
                        "label": "Errors/sec"
                    },
                    {
                        "format": "short"
                    }
                ],
                "alert": {
                    "conditions": [
                        {
                            "evaluator": {
                                "params": [
                                    0.05
                                ],
                                "type": "gt"
                            },
                            "operator": {
                                "type": "and"
                            },
                            "query": {
                                "params": [
                                    "A",
                                    "5m",
                                    "now"
                                ]
                            },
                            "reducer": {
                                "params": [],
                                "type": "avg"
                            },
                            "type": "query"
                        }
                    ],
                    "executionErrorState": "alerting",
                    "frequency": "1m",
                    "handler": 1,
                    "name": "High Error Rate",
                    "noDataState": "no_data",
                    "notifications": []
                }
            },
            {
                "id": 4,
                "title": "Response Time (p95)",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 0,
                    "y": 12
                },
                "targets": [
                    {
                        "expr": "histogram_quantile(0.95, rate(cortexdx_mcp_request_duration_seconds_bucket[5m]))",
                        "legendFormat": "p95"
                    },
                    {
                        "expr": "histogram_quantile(0.50, rate(cortexdx_mcp_request_duration_seconds_bucket[5m]))",
                        "legendFormat": "p50"
                    }
                ],
                "yaxes": [
                    {
                        "format": "s",
                        "label": "Duration"
                    },
                    {
                        "format": "short"
                    }
                ]
            },
            {
                "id": 5,
                "title": "Memory Usage",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 12,
                    "y": 12
                },
                "targets": [
                    {
                        "expr": "container_memory_working_set_bytes{pod=~\"cortexdx-.*\"} / 1024 / 1024",
                        "legendFormat": "{{pod}}"
                    }
                ],
                "yaxes": [
                    {
                        "format": "mbytes",
                        "label": "Memory"
                    },
                    {
                        "format": "short"
                    }
                ]
            },
            {
                "id": 6,
                "title": "CPU Usage",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 0,
                    "y": 20
                },
                "targets": [
                    {
                        "expr": "rate(container_cpu_usage_seconds_total{pod=~\"cortexdx-.*\"}[5m]) * 100",
                        "legendFormat": "{{pod}}"
                    }
                ],
                "yaxes": [
                    {
                        "format": "percent",
                        "label": "CPU %"
                    },
                    {
                        "format": "short"
                    }
                ]
            },
            {
                "id": 7,
                "title": "LLM Inference Latency",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 12,
                    "y": 20
                },
                "targets": [
                    {
                        "expr": "histogram_quantile(0.95, rate(cortexdx_mcp_llm_inference_duration_seconds_bucket[5m]))",
                        "legendFormat": "{{backend}} p95"
                    }
                ],
                "yaxes": [
                    {
                        "format": "s",
                        "label": "Duration"
                    },
                    {
                        "format": "short"
                    }
                ]
            },
            {
                "id": 8,
                "title": "Active Diagnostic Sessions",
                "type": "stat",
                "gridPos": {
                    "h": 4,
                    "w": 6,
                    "x": 6,
                    "y": 0
                },
                "targets": [
                    {
                        "expr": "cortexdx_mcp_active_sessions",
                        "legendFormat": "Active"
                    }
                ],
                "options": {
                    "colorMode": "value",
                    "graphMode": "area",
                    "textMode": "value_and_name"
                }
            },
            {
                "id": 9,
                "title": "Pattern Matches",
                "type": "stat",
                "gridPos": {
                    "h": 4,
                    "w": 6,
                    "x": 12,
                    "y": 0
                },
                "targets": [
                    {
                        "expr": "rate(cortexdx_mcp_pattern_matches_total[5m])",
                        "legendFormat": "Matches/sec"
                    }
                ],
                "options": {
                    "colorMode": "value",
                    "graphMode": "area",
                    "textMode": "value_and_name"
                }
            },
            {
                "id": 10,
                "title": "Database Query Performance",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 0,
                    "y": 28
                },
                "targets": [
                    {
                        "expr": "histogram_quantile(0.95, rate(cortexdx_mcp_database_query_duration_seconds_bucket[5m]))",
                        "legendFormat": "p95"
                    }
                ],
                "yaxes": [
                    {
                        "format": "s",
                        "label": "Duration"
                    },
                    {
                        "format": "short"
                    }
                ]
            },
            {
                "id": 11,
                "title": "Storage Usage",
                "type": "graph",
                "gridPos": {
                    "h": 8,
                    "w": 12,
                    "x": 12,
                    "y": 28
                },
                "targets": [
                    {
                        "expr": "kubelet_volume_stats_used_bytes{persistentvolumeclaim=~\"cortexdx-.*\"} / kubelet_volume_stats_capacity_bytes{persistentvolumeclaim=~\"cortexdx-.*\"} * 100",
                        "legendFormat": "{{persistentvolumeclaim}}"
                    }
                ],
                "yaxes": [
                    {
                        "format": "percent",
                        "label": "Usage %"
                    },
                    {
                        "format": "short"
                    }
                ]
            }
        ]
    }
}